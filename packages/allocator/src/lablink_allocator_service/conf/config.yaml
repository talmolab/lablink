# LabLink Allocator Configuration (Local Development)
# This file is used as fallback for local development when /config/config.yaml doesn't exist
# Production deployments should use lablink-infrastructure/config/config.yaml

db:
  dbname: "lablink_db"
  user: "lablink"
  password: "PLACEHOLDER_DB_PASSWORD"  # Injected from GitHub secret at deploy time
  host: "localhost"
  port: 5432
  table_name: "vms"
  message_channel: "vm_updates"

machine:
  # Client VM instance type (must support your workload)
  machine_type: "g4dn.xlarge"  # GPU instance for ML workloads

  # Docker image for client VMs (use version tags for production)
  image: "ghcr.io/talmolab/lablink-client-base-image:linux-amd64-test"

  # AMI ID for your AWS region (Ubuntu 24.04 with Docker + Nvidia)
  ami_id: "ami-0601752c11b394251"  # us-west-2 Ubuntu 24.04 custom AMI

  # Git repository with your data/code
  repository: "https://github.com/talmolab/sleap-tutorial-data.git"

  # Software identifier for your application
  software: "sleap"

  # File extension for your data files
  extension: "slp"

app:
  admin_user: "admin"
  admin_password: "PLACEHOLDER_ADMIN_PASSWORD"  # Injected from GitHub secret at deploy time
  region: "us-west-2"  # Your AWS region

dns:
  enabled: true  # true = use DNS for allocator URL, false = IP-only access
  terraform_managed: false  # false = manual DNS (CloudFlare, etc.), true = Terraform manages Route53 records
  domain: "dev.lablink.sleap.ai"  # Full domain name for the allocator (supports sub-subdomains for environments)
  zone_id: ""  # (Optional) Route53 hosted zone ID to skip auto-lookup

eip:
  strategy: "dynamic"  # "persistent" = reuse tagged EIP, "dynamic" = create new EIP each time
  tag_name: "lablink-eip"  # Tag Name to identify reusable EIP (used with persistent strategy)

ssl:
  provider: "letsencrypt"  # "none" = HTTP only, "letsencrypt" = Caddy auto-SSL, "cloudflare" = CloudFlare proxy, "acm" = AWS Certificate Manager
  email: "admin@sleap.ai"  # Email for Let's Encrypt notifications (required when provider="letsencrypt")
  certificate_arn: ""  # ACM certificate ARN (required when provider="acm")

allocator:
  # Docker image tag for the allocator service
  # Used by infrastructure deployment (Terraform)
  image_tag: "linux-amd64-latest-test"

# S3 bucket for Terraform state (must be unique globally)
# Only used for test/prod environments with S3 backend (not used in dev)
bucket_name: "tf-state-lablink-allocator-bucket"

startup_script:
  enabled: false # true = run custom startup script on client VMs, false = no script
  path: ""  # Path to custom startup script (optional)
  on_error: "continue"  # "continue" = ignore errors, "fail" = stop VM setup on error

monitoring:
  enabled: false  # true = enable CloudWatch alarms, SNS notifications, Budgets, CloudTrail
  email: ""  # Email address for alert notifications (required when enabled=true)
  thresholds:
    max_instances_per_5min: 10  # Max instance launches in 5-minute window
    max_terminations_per_5min: 20  # Max instance terminations in 5-minute window
    max_unauthorized_calls_per_15min: 5  # Max unauthorized API calls in 15-minute window
  budget:
    enabled: false  # true = enable AWS Budget monitoring
    monthly_budget_usd: 500  # Monthly budget limit in USD
  cloudtrail:
    retention_days: 90  # Days to retain CloudTrail logs